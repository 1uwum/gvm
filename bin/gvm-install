#!/bin/bash
INSTALL_ROOT=$GVM_ROOT/gos/go-$2
if [[ $1 == "install" ]]; then
  if [[ -n $2 ]]; then
    curl -s https://go.googlecode.com/hg/.hgtags | grep release.r$2 > /dev/null 2>&1
    if [[ $? == 0 ]]; then
      echo "Installing version $2"
      echo " * Downloading..."
      hg clone -u release.r$2 https://go.googlecode.com/hg/ $INSTALL_ROOT > /dev/null 2>&1
      echo " * Compiling..."
      cd $INSTALL_ROOT/src;unset GOROOT;unset GOARCH; unset GOOS; unset GOPATH;./all.bash > $INSTALL_ROOT/install.log 2>&1
      if [[ $? == 0 ]]; then
        mkdir -p $GVM_ROOT/pkgs/go-$2
        exit 0
      else
        echo "Failed to install version $2. See logs in $INSTALL_ROOT/install.log for details"
        exit 1
      fi
    else
      echo "ERROR: Unknown go release version: '$2'"
    fi
  else
    echo "ERROR: Please specifiy the version"
    exit 1
  fi
else
  echo "Please use gvm [action] to call this file"
  exit 1
fi

